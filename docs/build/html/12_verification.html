

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Verification &mdash; Python productivity for Zynq (Pynq) v1.0</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Python productivity for Zynq (Pynq) v1.0" href="index.html"/>
        <link rel="next" title="pynq" href="modules.html"/>
        <link rel="prev" title="The Pynq (Python Productivity for Zynq) Package" href="11_python_package.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python productivity for Zynq (Pynq)
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="1_pynq.html">PYNQ Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_jupyter_notebook.html">Introduction to Jupyter Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_programming_python.html">Cortex-A9 programming in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_programming_onboard.html">Programming PYNQ-Z1&#8217;s onboard peripherals</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_overlays.html">Hardware and Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="6a_base_overlay_iop.html">Using Peripherals with the Base overlay</a></li>
<li class="toctree-l1"><a class="reference internal" href="6b_base_overlay_video.html">Video using the Base Overlay</a></li>
<li class="toctree-l1"><a class="reference internal" href="6c_base_overlay_audio.html">Audio using the Base Overlay</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_iop_architecture.html">IO Processor Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_iop_code.html">IO Processors: Writing Your Own Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_creating_overlays.html">Working with Overlays</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_python_package.html">The <code class="docutils literal"><span class="pre">Pynq</span></code> (Python Productivity for Zynq) Package</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Verification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#collection-phase">Collection Phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-phase">Testing Phase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-tests">Writing Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#step-1">Step 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-2">Step 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#step-3">Step 3</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#miscellaneous-test-setup">Miscellaneous Test Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adc-jumper">ADC Jumper</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cable-type">Cable Type</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">pynq</a></li>
<li class="toctree-l1"><a class="reference internal" href="14_faqs.html">Frequently Asked Questions (FAQs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="15_glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="16_references.html">Useful Reference Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="17_appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Python productivity for Zynq (Pynq)</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Verification</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/12_verification.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: navy;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: darkred;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansiblack { color: black; }
.ansired { color: darkred; }
.ansigreen { color: darkgreen; }
.ansiyellow { color: #c4a000; }
.ansiblue { color: darkblue; }
.ansipurple { color: darkviolet; }
.ansicyan { color: steelblue; }
/* See https://github.com/jupyter/nbconvert/issues/174 */
.ansigray { color: gray; }  /* nbconvert CSS */
.ansigrey { color: gray; }  /* nbconvert HTML output */

.ansibgblack { background-color: black; }
.ansibgred { background-color: red; }
.ansibggreen { background-color: green; }
.ansibgyellow { background-color: yellow; }
.ansibgblue { background-color: blue; }
.ansibgpurple { background-color: magenta; }
.ansibgcyan { background-color: cyan; }
.ansibggray { background-color: gray; }

.ansibold { font-weight: bold; }
</style>
<div class="section" id="verification">
<h1><a class="toc-backref" href="#id1">Verification</a><a class="headerlink" href="#verification" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#verification" id="id1">Verification</a><ul>
<li><a class="reference internal" href="#running-tests" id="id2">Running Tests</a></li>
<li><a class="reference internal" href="#writing-tests" id="id3">Writing Tests</a></li>
<li><a class="reference internal" href="#miscellaneous-test-setup" id="id4">Miscellaneous Test Setup</a></li>
</ul>
</li>
</ul>
</div>
<p>This section documents the test infrastructure supplied with the <cite>pynq</cite> package. It is organized as follows:</p>
<ul class="simple">
<li><em>Running Tests</em> : describes how to run the pytest.</li>
<li><em>Writing Tests</em> : explains how to write tests.</li>
<li><em>Miscellaneous</em> : covers additional information relating to tests.</li>
</ul>
<div class="section" id="running-tests">
<h2><a class="toc-backref" href="#id2">Running Tests</a><a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>The <em>pynq</em> package provides tests for most python modules.</p>
<p>To run all the tests together, pytest can be run in a Linux terminal on the board. All the tests will be automatically collected in the current directory and child directories.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The pytests have to be run as root</p>
</div>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd /usr/local/lib/python3.4/dist-packages/pynq</span>
<span class="go">sudo py.test –vsrw</span>
</pre></div>
</div>
<p>For a complete list of pytest options, please refer to <a class="reference external" href="https://pytest.org/latest/usage.html">Usage and Invocations - Pytest</a>.</p>
<div class="section" id="collection-phase">
<h3>Collection Phase<a class="headerlink" href="#collection-phase" title="Permalink to this headline">¶</a></h3>
<p>During this phase, the pytest will collect all the test modules in the current directory and all of its child directories. The user will be asked if a Pmod is connected, and to which port it is connected.</p>
<p>For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">Is LED8 attached to the board? ([yes]/no)&gt;&gt;&gt; yes</span>
<span class="go">Type in the Pmod ID of the LED8 (1 ~ 2):</span>
</pre></div>
</div>
<p>For the answer to the first question, &#8220;yes&#8221;, &#8220;YES&#8221;, &#8220;Yes&#8221;, &#8220;y&#8221;, and &#8220;Y&#8221; are acceptable; the same applies for &#8220;no&#8221; as an answer. You can also press <em>Enter</em>; this is equivalent to &#8220;yes&#8221;.</p>
<p>Type 1 (for PMODA) or 2 (for PMODB).</p>
<p>Answering &#8220;No&#8221; will skip the corresponding test(s) during the testing phase.</p>
</div>
<div class="section" id="testing-phase">
<h3>Testing Phase<a class="headerlink" href="#testing-phase" title="Permalink to this headline">¶</a></h3>
<p>The test suite will guide the user through all the tests implemented in the pynq package. As part of the tests, the user will be prompted for confirmation that the tests have passed, for example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">test_led0 ...</span>
<span class="go">Onboard LED 0 on? ([yes]/no)&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Again press &#8220;Enter&#8221;, or type &#8220;yes&#8221;, &#8220;no&#8221; etc.</p>
<p>At the end of the testing phase, a summary will be given to show users how many tests are passed / skipped / failed.</p>
</div>
</div>
<div class="section" id="writing-tests">
<h2><a class="toc-backref" href="#id3">Writing Tests</a><a class="headerlink" href="#writing-tests" title="Permalink to this headline">¶</a></h2>
<p>This section follows the guide available on <a class="reference external" href="https://pytest.org/latest/example/">Pytest Usages and Examples</a>. You can write a test class with assertions on inputs and outputs to allow automatic testing. The names of the test modules <em>must</em> start with <cite>test_</cite>; all the methods for tests in any test module <em>must</em> also begin with <cite>test_</cite>. One reason to enforce this is to ensure the tests will be collected properly. See the <a class="reference external" href="https://pytest.org/latest/contents.html">Full pytest documentation</a> for more details.</p>
<div class="section" id="step-1">
<h3>Step 1<a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h3>
<p>First of all, the pytest package has to be imported:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2">
<h3>Step 2<a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h3>
<p>Decorators can be specified directly above the methods. For example, you can specify (1) the order of this test in the entire pytest process, and (2) the condition to skip the corresponding test. More information on decorators can be found in <a class="reference external" href="https://pytest.org/latest/mark.html">Marking test functions with attributes - Pytest</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@pytest.mark.run</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
<span class="nd">@pytest.mark.skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">flag</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;need both ADC and DAC attached&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3">
<h3>Step 3<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h3>
<p>Directly below decorators, you can write some assertions/tests. See the example below:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@pytest.mark.run</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
<span class="nd">@pytest.mark.skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">flag</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;need both ADC and DAC attached&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_loop_single</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test for writing a single value via the loop.</span>

<span class="sd">    First check whether read() correctly returns a string. Then ask the users</span>
<span class="sd">    to write a voltage on the DAC, read from the ADC, and compares the two</span>
<span class="sd">    voltages.</span>

<span class="sd">    The exception is raised when the difference is more than 10% and more than</span>
<span class="sd">    0.1V.</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Users can use a straight cable (instead of wires) to do this test.</span>
<span class="sd">    For the 6-pin DAC Pmod, it has to be plugged into the upper row of the</span>
<span class="sd">    Pmod interface.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">dac</span><span class="p">,</span><span class="n">adc</span>
    <span class="n">dac</span> <span class="o">=</span> <span class="n">Pmod_DAC</span><span class="p">(</span><span class="n">dac_id</span><span class="p">)</span>
    <span class="n">adc</span> <span class="o">=</span> <span class="n">Pmod_ADC</span><span class="p">(</span><span class="n">adc_id</span><span class="p">)</span>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Insert a voltage in the range of [0.00, 2.00]: &quot;</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">value</span><span class="o">&lt;=</span><span class="mf">2.00</span><span class="p">,</span> <span class="s1">&#39;Input voltage should not be higher than 2.00V.&#39;</span>
    <span class="k">assert</span> <span class="n">value</span><span class="o">&gt;=</span><span class="mf">0.00</span><span class="p">,</span> <span class="s1">&#39;Input voltage should not be lower than 0.00V.&#39;</span>
    <span class="n">dac</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="n">adc</span><span class="o">.</span><span class="n">read</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">value</span><span class="p">),</span> \
            <span class="s1">&#39;Read value != write value.&#39;</span>
</pre></div>
</div>
<p>Note the <cite>assert</cite> statements specify the desired condition, and raise exceptions whenever that condition is not met. A customized exception message can be attached at the end of the <cite>assert</cite> methods, as shown in the example above.</p>
</div>
</div>
<div class="section" id="miscellaneous-test-setup">
<h2><a class="toc-backref" href="#id4">Miscellaneous Test Setup</a><a class="headerlink" href="#miscellaneous-test-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="adc-jumper">
<h3>ADC Jumper<a class="headerlink" href="#adc-jumper" title="Permalink to this headline">¶</a></h3>
<p>In our tests and demos, we have used a Pmod ADC. In order to make it work properly with the testing environment, you need to set a jumper <strong>JP1</strong> to <strong>REF</strong> on the Pmod ADC. This will allow the ADC to use the correct reference voltage.</p>
<a class="reference internal image-reference" href="_images/adc_jumper.jpeg"><img alt="_images/adc_jumper.jpeg" src="_images/adc_jumper.jpeg" style="width: 200px;" /></a>
</div>
<div class="section" id="cable-type">
<h3>Cable Type<a class="headerlink" href="#cable-type" title="Permalink to this headline">¶</a></h3>
<p>Two types of cables can be used with the tests in the pynq package, a &#8220;straight&#8221; cable, and a &#8220;loopback&#8221; cable:</p>
<a class="reference internal image-reference" href="_images/cable_type.jpeg"><img alt="_images/cable_type.jpeg" src="_images/cable_type.jpeg" style="width: 400px;" /></a>
<ul class="simple">
<li><em>Straight cable</em> (upper one in the image): The internal wires between the two ends are straight. This cable is intended for use as an extension cable.</li>
<li><em>Loopback cable</em> (lower one in the image, with red ribbon): The internal wires are twisted. This cable is intended for testing.</li>
</ul>
<p>There are marks on the connectors at each end of the cable to indicate the orientation and wiring of the cable.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must not short VCC and GND as it may damage the board. It is good practice to align the pins with the dot marks to VCC of the Pmod interfaces.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For testing, there is only one connection type (mapping) allowed for each cable type. Otherwise VCC and GND could be shorted, damaging the board.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="pynq" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="11_python_package.html" class="btn btn-neutral" title="The Pynq (Python Productivity for Zynq) Package" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Xilinx.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>